
name: Naukri Profile Updater

on:
  schedule:
    # 5:00 AM IST daily => 23:30 UTC daily (previous day)
    - cron: '30 23 * * *'
    # 9:00 AM IST daily => 03:30 UTC daily
    - cron: '30 3 * * *'
  workflow_dispatch:  # allows manual runs from Actions tab

jobs:
  update-profile:
    name: Run Naukri update
    runs-on: ubuntu-latest
    timeout-minutes: 20

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.10'

      - name: Install Python dependencies
        run: |
          python -m pip install --upgrade pip
          pip install -r requirements.txt

      - name: Install Chromium & Chromedriver
        run: |
          sudo apt-get update
          # Install Chromium browser & matching driver
          sudo apt-get install -y chromium-browser chromium-chromedriver
          # Confirm versions/paths
          chromium-browser --version || chromium --version || true
          chromedriver --version || true

      - name: Set environment for Selenium
        run: |
          echo "Setting CHROME paths for Selenium"
          echo "CHROME_BINARY=/usr/bin/chromium-browser" >> $GITHUB_ENV
          echo "CHROMEDRIVER_PATH=/usr/bin/chromedriver" >> $GITHUB_ENV

      - name: Run Naukri Update Script
        env:
          NAUKRI_USERNAME: ${{ secrets.NAUKRI_USERNAME }}
          NAUKRI_PASSWORD: ${{ secrets.NAUKRI_PASSWORD }}
          RESUME_PATH:     ${{ secrets.RESUME_PATH }}
          CHROME_BINARY:   ${{ env.CHROME_BINARY }}
          CHROMEDRIVER_PATH: ${{ env.CHROMEDRIVER_PATH }}
        run: |
          # If your script needs these env vars, ensure naukri.py reads them.
          # Example (inside Python): os.getenv("NAUKRI_USERNAME"), etc.
          python naukri.py

      - name: Archive logs (optional)
        if: always()
        uses: actions/upload-artifact@v4
        with:
          name: run-logs
          path: |
            **/*.log
            logs/**
          if-no-files-found: ignore
